# Р СѓРєРѕРІРѕРґСЃС‚РІРѕ РїРѕР»СЊР·РѕРІР°С‚РµР»СЏ (Dashboard)

## Р’С…РѕРґ РІ СЃРёСЃС‚РµРјСѓ
1. РЎРѕР·РґР°Р№С‚Рµ Р°РґРјРёРЅРёСЃС‚СЂР°С‚РѕСЂР°:
   ```bash
   php run admin:create
   ```
2. РћС‚РєСЂРѕР№С‚Рµ `http://<host>/dashboard/login` Рё РІРѕР№РґРёС‚Рµ РїРѕ email/РїР°СЂРѕР»СЋ.

## РЎРѕРѕР±С‰РµРЅРёСЏ (Messages)
- Р Р°Р·РґРµР» Send РїРѕР·РІРѕР»СЏРµС‚ РѕС‚РїСЂР°РІРёС‚СЊ:
  - С‚РµРєСЃС‚, С„РѕС‚Рѕ, Р°СѓРґРёРѕ, РІРёРґРµРѕ, РґРѕРєСѓРјРµРЅС‚, СЃС‚РёРєРµСЂ, Р°РЅРёРјР°С†РёСЋ, РіРѕР»РѕСЃРѕРІРѕРµ, РєСЂСѓРіР»СЏС€, РјРµРґРёР°вЂ‘РіСЂСѓРїРїСѓ;
  - РѕРґРЅРѕРјСѓ С‡Р°С‚Сѓ, РІС‹Р±СЂР°РЅРЅС‹Рј С‡Р°С‚Р°Рј РёР»Рё РІСЃРµРј (РІ Р·Р°РІРёСЃРёРјРѕСЃС‚Рё РѕС‚ РЅР°СЃС‚СЂРѕРµРє РїР°РЅРµР»Рё).
- РџСЂРё РѕС‚РїСЂР°РІРєРµ РјРµРґРёР° СѓС‡РёС‚С‹РІР°Р№С‚Рµ Р»РёРјРёС‚С‹ СЂР°Р·РјРµСЂРѕРІ Telegram Bot API.

## Р¤Р°Р№Р»С‹ (Files)
- Р—Р°РіСЂСѓР·РєР° Рё РїСЂРѕСЃРјРѕС‚СЂ С„Р°Р№Р»РѕРІ, РґРѕСЃС‚СѓРїРЅС‹С… РґР»СЏ РїРѕСЃР»РµРґСѓСЋС‰РµР№ РѕС‚РїСЂР°РІРєРё Р±РѕС‚РѕРј.

## РџСЂРѕРјРѕРєРѕРґС‹ (Promo Codes)
- Р Р°Р·РґРµР» РґРѕСЃС‚СѓРїРµРЅ РїРѕ Р°РґСЂРµСЃСѓ `/dashboard/promo-codes`.
- Р—Р°РіСЂСѓР·РєР° CSV (`/dashboard/promo-codes/upload`):
  - РґРѕРїСѓСЃС‚РёРјС‹Рµ С‚РёРїС‹: `text/csv`, `text/plain`, `application/vnd.ms-excel`;
  - СЂР°Р·РјРµСЂ в‰¤ min(`REQUEST_SIZE_LIMIT`, 5MB);
  - РїРµСЂРІР°СЏ СЃС‚СЂРѕРєР° вЂ” Р·Р°РіРѕР»РѕРІРѕРє СЃ РєРѕР»РѕРЅРєРѕР№ `code` (РѕРїС†РёРѕРЅР°Р»СЊРЅРѕ `expires_at`, `meta`).
  - РїРѕ Р·Р°РІРµСЂС€РµРЅРёРё РѕС‚РѕР±СЂР°Р¶Р°СЋС‚СЃСЏ СЃС‡С‘С‚С‡РёРєРё В«РёРјРїРѕСЂС‚РёСЂРѕРІР°РЅРѕ / РїСЂРѕРїСѓС‰РµРЅРѕ (РґСѓР±Р»РёРєР°С‚С‹)В».
- РЎРїРёСЃРѕРє РєРѕРґРѕРІ: С„РёР»СЊС‚СЂС‹ РїРѕ СЃС‚Р°С‚СѓСЃСѓ, Р±Р°С‚С‡Сѓ Рё РїРѕРёСЃРєСѓ РїРѕ `code`, РїР°РіРёРЅР°С†РёСЏ 20вЂ“50.
- Р’С‹РґР°С‡Р°: СЂСЏРґРѕРј СЃ РєРѕРґРѕРј СѓРєР°Р¶РёС‚Рµ `telegram_user_id` Рё РЅР°Р¶РјРёС‚Рµ В«Р’С‹РґР°С‚СЊВ». Р’С‹РґР°С‡Р° РїСЂРѕРІРµСЂСЏРµС‚ СЃСЂРѕРє РґРµР№СЃС‚РІРёСЏ Рё СЃС‚Р°С‚СѓСЃ Рё РїРёС€РµС‚ Р·Р°РїРёСЃСЊ РІ РѕС‚С‡С‘С‚.
- РћС‚С‡С‘С‚: `/dashboard/promo-codes/issues` вЂ” С„РёР»СЊС‚СЂС‹ РїРѕ РґР°С‚Рµ Рё `telegram_user_id`, РєРЅРѕРїРєР° В«Р­РєСЃРїРѕСЂС‚ CSVВ» СЃРѕС…СЂР°РЅСЏРµС‚ С‚РµРєСѓС‰СѓСЋ РІС‹Р±РѕСЂРєСѓ.
- Р‘Р°С‚С‡Рё: `/dashboard/promo-codes/batches` вЂ” Р°РіСЂРµРіР°С‚С‹ РїРѕ СЃС‚Р°С‚СѓСЃР°Рј (available/issued/expired) Рё total.

## РћР±РЅРѕРІР»РµРЅРёСЏ (Updates)
- РџСЂРѕСЃРјРѕС‚СЂ РїРѕСЃР»РµРґРЅРёС… Р°РїРґРµР№С‚РѕРІ, С‚РёРїРѕРІ Рё СЃС‚Р°С‚СѓСЃРѕРІ РѕР±СЂР°Р±РѕС‚РєРё.

## РћРїР»Р°С‚С‹ (Payments)
- Р’СЃС‚СЂРѕРµРЅРЅР°СЏ РїРѕРґРґРµСЂР¶РєР° Telegram Payments: РѕС‚РїСЂР°РІРєР° РёРЅРІРѕР№СЃРѕРІ Рё РЅР°Р±Р»СЋРґРµРЅРёРµ СЃРѕР±С‹С‚РёР№.
- Р Р°Р·РґРµР»С‹ Dashboard:
  - `/dashboard/invoices/create` вЂ” РѕС‚РїСЂР°РІРєР° РёРЅРІРѕР№СЃР° (`sendInvoice`).
  - `/dashboard/pre-checkout` вЂ” СЃРїРёСЃРѕРє pre-checkout СЃРѕР±С‹С‚РёР№.
  - `/dashboard/shipping` вЂ” СЃРїРёСЃРѕРє shipping-Р·Р°РїСЂРѕСЃРѕРІ.

### РљР°Рє РѕС‚РїСЂР°РІРёС‚СЊ РёРЅРІРѕР№СЃ (sendInvoice)
1. РћС‚РєСЂРѕР№С‚Рµ `/dashboard/invoices/create`.
2. Р—Р°РїРѕР»РЅРёС‚Рµ РїРѕР»СЏ:
   - `chat_id` вЂ” ID РїРѕР»СѓС‡Р°С‚РµР»СЏ (РјРѕР¶РЅРѕ Р·Р°РґР°С‚СЊ РїРѕ СѓРјРѕР»С‡Р°РЅРёСЋ `DEFAULT_CHAT_ID` РІ .env).
   - `title`, `description` вЂ” Р·Р°РіРѕР»РѕРІРѕРє Рё РѕРїРёСЃР°РЅРёРµ Р·Р°РєР°Р·Р°.
   - `payload` вЂ” РІР°С€ СЃР»СѓР¶РµР±РЅС‹Р№ РёРґРµРЅС‚РёС„РёРєР°С‚РѕСЂ Р·Р°РєР°Р·Р°/РєРѕСЂР·РёРЅС‹.
   - `provider_token` вЂ” С‚РѕРєРµРЅ РїР»Р°С‚РµР¶РЅРѕРіРѕ РїСЂРѕРІР°Р№РґРµСЂР° (РёР· @BotFather).
   - `currency` вЂ” РІР°Р»СЋС‚Р° (РЅР°РїСЂРёРјРµСЂ, `USD`, `EUR`, `RUB`).
   - `prices` вЂ” JSON РјР°СЃСЃРёРІ `LabeledPrice` РёР· Bot API (РІ РјРёРЅРёРјР°Р»СЊРЅС‹С… РµРґРёРЅРёС†Р°С…):
     РџСЂРёРјРµСЂ: `[{"label":"Item","amount":1990}]`.
3. РћРїС†РёРѕРЅР°Р»СЊРЅРѕ РІРєР»СЋС‡РёС‚Рµ:
   - `need_name`, `need_phone_number`, `need_email` вЂ” Р·Р°РїСЂРѕСЃРёС‚СЊ Сѓ РїРѕР»СЊР·РѕРІР°С‚РµР»СЏ РґР°РЅРЅС‹Рµ.
   - `need_shipping_address` вЂ” Р·Р°РїСЂРѕСЃРёС‚СЊ Р°РґСЂРµСЃ РґРѕСЃС‚Р°РІРєРё.
   - `is_flexible` вЂ” РіРёР±РєР°СЏ С†РµРЅР° (РІС‹Р·РѕРІРµС‚ shipping query, С‚СЂРµР±СѓРµС‚СЃСЏ РѕС‚РІРµС‚ СЃ РІР°СЂРёР°РЅС‚Р°РјРё РґРѕСЃС‚Р°РІРєРё).
4. РћС‚РїСЂР°РІСЊС‚Рµ С„РѕСЂРјСѓ вЂ” РёРЅРІРѕР№СЃ РїРѕРїР°РґРµС‚ РІ РѕС‡РµСЂРµРґСЊ Рё Р±СѓРґРµС‚ РѕС‚РїСЂР°РІР»РµРЅ Р±РѕС‚РѕРј.

РџРѕСЃР»Рµ РїРѕРґС‚РІРµСЂР¶РґРµРЅРёСЏ РѕРїР»Р°С‚С‹ РїРѕР»СЊР·РѕРІР°С‚РµР»РµРј Р±РѕС‚ РїРѕР»СѓС‡РёС‚ `pre_checkout_query` Рё РѕС‚РІРµС‚РёС‚ РЅР° РЅРµРіРѕ Р°РІС‚РѕРјР°С‚РёС‡РµСЃРєРё (РѕРє = true). Р­С‚Рё СЃРѕР±С‹С‚РёСЏ РїРёС€СѓС‚СЃСЏ РІ С‚Р°Р±Р»РёС†Сѓ `tg_pre_checkout` Рё РІРёРґРЅС‹ РІ `/dashboard/pre-checkout`.

Р•СЃР»Рё РІРєР»СЋС‡РµРЅР° РґРѕСЃС‚Р°РІРєР° (`need_shipping_address`/`is_flexible`), РїСЂРё РІРІРѕРґРµ Р°РґСЂРµСЃР° Telegram РїСЂРёС€Р»РµС‚ `shipping_query`. Р‘Р°Р·РѕРІС‹Р№ РѕР±СЂР°Р±РѕС‚С‡РёРє РѕС‚РІРµС‡Р°РµС‚ `ok=true` Р±РµР· РІР°СЂРёР°РЅС‚РѕРІ РґРѕСЃС‚Р°РІРєРё. Р”Р»СЏ СЂРµР°Р»СЊРЅРѕР№ РґРѕСЃС‚Р°РІРєРё Р·Р°РґР°Р№С‚Рµ РІР°СЂРёР°РЅС‚С‹ РІ `app/Handlers/Telegram/ShippingQueries/DefaultShippingQueryHandler.php` (РјРµС‚РѕРґ `answerShippingQuery(...)`).

РџСЂРёРјРµС‡Р°РЅРёРµ: Р”Р°С€Р±РѕСЂРґС‹ РёСЃРїРѕР»СЊР·СѓСЋС‚ С‚Р°Р±Р»РёС†С‹ `tg_pre_checkout` Рё `tg_shipping_queries`. Р’СЃРµ РїРѕСЃС‚СѓРїР°СЋС‰РёРµ СЃРѕР±С‹С‚РёСЏ Р°РІС‚РѕРјР°С‚РёС‡РµСЃРєРё СЃРѕС…СЂР°РЅСЏСЋС‚СЃСЏ С‚СѓРґР°.

## РЎРµСЃСЃРёРё Рё Р»РѕРіРё
- РџСЂРѕСЃРјРѕС‚СЂ Р°РєС‚РёРІРЅС‹С… СЃРµСЃСЃРёР№ РґР»СЏ РїР°РЅРµР»Рё.
- РџСЂРѕСЃРјРѕС‚СЂ Р»РѕРіРѕРІ Рё Р±С‹СЃС‚СЂС‹Р№ РїРѕРёСЃРє РїРѕ РЅРёРј.

## РЎРѕРІРµС‚С‹ РїРѕ Р±РµР·РѕРїР°СЃРЅРѕСЃС‚Рё
- РСЃРїРѕР»СЊР·СѓР№С‚Рµ HTTPS.
- РќРµ РІРєР»СЋС‡Р°Р№С‚Рµ `APP_DEBUG` РІ РїСЂРѕРґРµ.
- РћРіСЂР°РЅРёС‡СЊС‚Рµ РґРѕСЃС‚СѓРї Рє РїР°РЅРµР»Рё СЃ РїРѕРјРѕС‰СЊСЋ VPN/IPвЂ‘С„РёР»СЊС‚СЂРѕРІ, РµСЃР»Рё СЌС‚Рѕ РІРѕР·РјРѕР¶РЅРѕ.

## UTM отчёт
- Откройте `/dashboard/utm`.
- Выберите период с помощью полей `from` и `to` и нажмите «Применить».
- В таблице отобразятся суммы по каждой UTM-метке и итоговая сумма по периоду.
- Примечание: суммы в минимальных единицах валюты (центы/копейки) как в Telegram Payments.
