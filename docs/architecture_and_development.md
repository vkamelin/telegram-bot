# Архитектура и процесс разработки

## Архитектура системы
- Основа — [Slim 4](https://www.slimframework.com/) как HTTP-микрофреймворк.
- Контроллеры из `app/Controllers` реализуют REST API и взаимодействие с Telegram.
- Middleware:
  - `JwtMiddleware` — проверка JWT и авторизация.
  - `RateLimitMiddleware` — ограничение частоты запросов.
  - `ErrorMiddleware` — единый формат ошибок RFC7807.
- Helpers в `app/Helpers` предоставляют общие сервисы: работу с БД, Redis, логирование и формирование ответов.
- Workers (`workers/*.php`) выполняют фоновые задачи: long polling Telegram, обработка сообщений, интеграция с GPT, очистка токенов.

### Используемые технологии
- PHP 8.3
- PDO
- Redis
- Telegram Bot API
- Docker

## Компоненты
- HTTP API с контроллерами и middleware.
- Вспомогательные сервисы (helpers).
- Фоновые workers для обработки задач.

## Разработка
- **Trunk-based**: коммиты делаются в `main`, feature-ветки короткоживущие.
- **Pull-requestы** обязательны для всех изменений и проходят review.
- **CI/CD** запускает тесты и анализаторы и автоматически деплоит после слияния.

## Инфраструктура
- Docker Compose для локального окружения и запуска сервисов.
- База данных MySQL.
- Redis для кеша и очередей.
- Отдельные workers в контейнерах для фоновых задач.

