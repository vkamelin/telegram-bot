# Telegram Bot Backend: API + Dashboard

–ü–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω–Ω—ã–π –±—ç–∫–µ–Ω–¥ –¥–ª—è Telegram‚Äë–±–æ—Ç–∞ c –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω–æ–π –ø–∞–Ω–µ–ª—å—é (Dashboard) –∏ REST API. –û—Å–Ω–æ–≤–∞–Ω –Ω–∞ Slim 4 –∏ PDO, –±–µ–∑ —Ç—è–∂—ë–ª—ã—Ö —Ñ—Ä–µ–π–º–≤–æ—Ä–∫–æ–≤. –ü–æ–¥—Ö–æ–¥–∏—Ç –∫–∞–∫ —Å—Ç–∞—Ä—Ç–æ–≤—ã–π —à–∞–±–ª–æ–Ω –∏ –∫–∞–∫ –±–∞–∑–∞ –¥–ª—è MVP/–ø–µ—Ç‚Äë–ø—Ä–æ–µ–∫—Ç–∞.

## –°—Ç–µ–∫ –∏ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏
- Slim 4, PSR‚Äë7/PSR‚Äë15
- –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞: `public/index.php`
- API (`/api/*`) —Å JWT –∏ rate‚Äëlimit
- Dashboard (`/dashboard/*`) —Å —Å–µ—Å—Å–∏—è–º–∏ –∏ CSRF
- –ß–∏—Å—Ç—ã–π PDO (–±–µ–∑ ORM)
- –ï–¥–∏–Ω–æ–æ–±—Ä–∞–∑–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã –∏ –æ—à–∏–±–∫–∏ (RFC 7807)
- Workers + Supervisor –¥–ª—è —Ñ–æ–Ω–æ–≤—ã—Ö –∑–∞–¥–∞—á (long polling, –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫, GPT)
- Redis (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π –∏ –æ—Ñ—Ñ—Å–µ—Ç–∞ long polling
- Docker‚Äë–æ–∫—Ä—É–∂–µ–Ω–∏–µ (app + nginx + redis + supervisor)

–ü—Ä–æ–µ–∫—Ç –º–∏–Ω–∏–º–∞–ª–∏—Å—Ç–∏—á–Ω—ã–π, –Ω–æ —Ä–∞—Å—à–∏—Ä—è–µ–º—ã–π. –¶–µ–ª—å ‚Äî –ø–æ–Ω—è—Ç–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞, –±–µ–∑–æ–ø–∞—Å–Ω—ã–µ –¥–µ—Ñ–æ–ª—Ç—ã, —á—ë—Ç–∫–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è.

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞
```
app/
  Config/            # –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è, —á—Ç–µ–Ω–∏–µ .env
  Controllers/
    Api/             # API –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä—ã (/api/*)
    Dashboard/       # –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä—ã Dashboard (/dashboard/*)
  Helpers/           # —É—Ç–∏–ª–∏—Ç—ã (Response, Logger, Push, MediaBuilder, RedisHelper –∏ –¥—Ä.)
  Middleware/        # Error, RequestId, SizeLimit, SecurityHeaders, Session, Jwt, Csrf, RateLimit, TelegramInitData
  Telegram/          # UpdateFilter –∏ UpdateHelper
  Console/           # –º–∏–Ω–∏‚Äë–∫–æ–Ω—Å–æ–ª—å –∏ –∫–æ–º–∞–Ω–¥—ã
public/
  index.php          # bootstrap Slim + –º–∞—Ä—à—Ä—É—Ç—ã
workers/             # —Ñ–æ–Ω–æ–≤—ã–µ –≤–æ—Ä–∫–µ—Ä—ã (longpolling, handler, scheduler –∏ –¥—Ä.)
docker/              # –∫–æ–Ω—Ñ–∏–≥–∏ nginx –∏ supervisor –¥–ª—è Docker/VPS
```

## –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç (–ª–æ–∫–∞–ª—å–Ω–æ)
```bash
git clone <repo>
cd <repo>
composer install
cp .env.example .env
```
–î–∞–ª–µ–µ –∑–∞–ø–æ–ª–Ω–∏—Ç–µ `.env` (—Å–º. `ENVIRONMENT.md`). –ú–∏–Ω–∏–º—É–º: `DB_*`, `JWT_SECRET`, `BOT_TOKEN`.

–ú–∏–≥—Ä–∞—Ü–∏–∏ (Phinx):
```bash
php run migrate:run
```

–°–æ–∑–¥–∞–Ω–∏–µ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ Dashboard:
```bash
php run admin:create
```

–ó–∞–ø—É—Å–∫ –≤—Å—Ç—Ä–æ–µ–Ω–Ω–æ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞ –¥–ª—è –±—ã—Å—Ç—Ä–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏:
```bash
composer serve
```
–û—Ç–∫—Ä–æ–π—Ç–µ `http://127.0.0.1:8080/dashboard`.

## –ó–∞–ø—É—Å–∫ –≤ Docker
```bash
chmod +x docker/entrypoint.sh
docker compose up -d --build
```
–ü–æ–ª–µ–∑–Ω–æ: `docker compose logs -f`.

–ú–∏–≥—Ä–∞—Ü–∏–∏ –≤–Ω—É—Ç—Ä–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞:
```bash
docker compose exec app php run migrate:run
```

Supervisor –≤ Docker:
```bash
docker compose exec supervisor supervisorctl status
```

## –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
- JWT –¥–ª—è API –∏ —Å–µ—Å—Å–∏–∏+CSRF –¥–ª—è Dashboard
- Rate‚Äëlimit (–ø–æ IP –∏–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é)
- –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–∞ –∑–∞–ø—Ä–æ—Å–∞ (`REQUEST_SIZE_LIMIT`)
- CORS –∏ –±–∞–∑–æ–≤—ã–π CSP –≤ `SecurityHeadersMiddleware`
- –ï–¥–∏–Ω—ã–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –æ—à–∏–±–æ–∫ (RFC 7807)
- –ü—Ä–æ–≤–µ—Ä–∫–∞ Telegram `initData` –≤ `TelegramInitDataMiddleware` (–ø–æ–¥–ø–∏—Å—å –Ω–∞ –æ—Å–Ω–æ–≤–µ `BOT_TOKEN`)

## API (–∫—Ä–∞—Ç–∫–æ)
- `GET /api/health` ‚Äî –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è
- `POST /api/auth/login` ‚Äî –≤—Ö–æ–¥, –≤—ã–¥–∞—ë—Ç JWT
- `POST /api/auth/refresh` ‚Äî –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞ –ø–æ refresh‚Äë—Ç–æ–∫–µ–Ω—É
- `GET /api/me` ‚Äî –ø—Ä–æ—Ñ–∏–ª—å —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `GET /api/users` ‚Äî —Å–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- `POST /api/users` ‚Äî —Å–æ–∑–¥–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

–†–∞–∑–¥–µ–ª –ø—Ä–æ–º–æ–∫–æ–¥–æ–≤ (JWT):
- `POST /api/promo-codes/upload` ‚Äî –∑–∞–≥—Ä—É–∑–∫–∞ CSV (multipart/form-data, –ø–æ–ª–µ `file`). –ü–µ—Ä–≤–∞—è —Å—Ç—Ä–æ–∫–∞ ‚Äî –∑–∞–≥–æ–ª–æ–≤–æ–∫ —Å –∫–æ–ª–æ–Ω–∫–æ–π `code` (–æ–ø—Ü. `expires_at`, `meta`). –ü—Ä–∏ –¥—É–±–ª—è—Ö –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç 409.
- `GET /api/promo-codes` ‚Äî —Å–ø–∏—Å–æ–∫ –∫–æ–¥–æ–≤, —Ñ–∏–ª—å—Ç—Ä—ã: `status`, `batch_id`, `q`, `page`, `per_page`.
- `POST /api/promo-codes/issue` ‚Äî –≤—ã–¥–∞—á–∞ –∫–æ–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é: `{ "user_id": <telegram_user_id>, "batch_id"?: <id> }`.
- `GET /api/promo-code-issues` ‚Äî –ø–æ—Å–ª–µ–¥–Ω–∏–µ –≤—ã–¥–∞—á–∏ (limit).
- `GET /api/promo-code-batches` ‚Äî —Å–ø–∏—Å–æ–∫ –±–∞—Ç—á–µ–π.

–ü—Ä–∏–º–µ—Ä –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏:
```bash
curl -X POST http://localhost:8080/api/auth/login \
  -H "Content-Type: application/json" \
  -H "X-Telegram-Init-Data: <initData>" \
  -d '{"email":"user@example.com","password":"secret"}'
```
–û—Ç–≤–µ—Ç —Å–æ–¥–µ—Ä–∂–∏—Ç `token` (JWT). –î–∞–ª–µ–µ –¥–æ–±–∞–≤–ª—è–π—Ç–µ –∑–∞–≥–æ–ª–æ–≤–æ–∫ `Authorization: Bearer <token>` –∏ –ø–µ—Ä–µ–¥–∞–≤–∞–π—Ç–µ `initData` —Ç–µ–º –∂–µ —Å–ø–æ—Å–æ–±–æ–º.

–ü–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–∏ ‚Äî –≤ `docs/api.md` –∏ `docs/openapi.yaml`.

## Dashboard: —Ä–∞—Å—Å—ã–ª–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π
–†–∞–∑–¥–µ–ª Messages ‚Üí Send –ø–æ–∑–≤–æ–ª—è–µ—Ç –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è –≤ Telegram (–æ–¥–Ω–æ–º—É, –≥—Ä—É–ø–ø–µ –∏–ª–∏ –≤—Å–µ–º –≤—ã–±—Ä–∞–Ω–Ω—ã–º). –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è —Ç–∏–ø—ã: `text`, `photo`, `audio`, `video`, `document`, `sticker`, `animation`, `voice`, `video_note`, `media_group`.

–ü—Ä–∏–º–µ—Ä –æ—Ç–ø—Ä–∞–≤–∫–∏ Media Group —á–µ—Ä–µ–∑ —Ö–µ–ª–ø–µ—Ä—ã:
```php
use App\Helpers\Push;
use App\Helpers\MediaBuilder;

$media = [
    MediaBuilder::buildInputMedia('photo', 'https://example.com/a.jpg', ['caption' => '–ü—Ä–∏–º–µ—Ä 1']),
    MediaBuilder::buildInputMedia('video', 'https://example.com/b.mp4', ['caption' => '–ü—Ä–∏–º–µ—Ä 2']),
];

Push::mediaGroup(123456789, $media);
```

–î–ª—è –æ–¥–∏–Ω–æ—á–Ω—ã—Ö –º–µ–¥–∏–∞ –µ—Å—Ç—å `Push::photo()`, `Push::video()`, `Push::audio()`, `Push::document()` –∏ —Ç. –¥.

–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è Telegram: –æ–±—â–∏–π –∑–∞–ø—Ä–æ—Å —Å –º–µ–¥–∏–∞ –¥–æ–ª–∂–µ–Ω —É–∫–ª–∞–¥—ã–≤–∞—Ç—å—Å—è –≤ –ª–∏–º–∏—Ç—ã API; –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–π—Ç–µ —Ä–∞–∑–º–µ—Ä —á–µ—Ä–µ–∑ `REQUEST_SIZE_LIMIT` –∏ —É—á–∏—Ç—ã–≤–∞–π—Ç–µ –ª–∏–º–∏—Ç—ã Telegram Bot API.

## Dashboard: –ø—Ä–æ–º–æ–∫–æ–¥—ã
- –ú–∞—Ä—à—Ä—É—Ç—ã:
  - `GET /dashboard/promo-codes` ‚Äî —Å–ø–∏—Å–æ–∫ —Å —Ñ–∏–ª—å—Ç—Ä–∞–º–∏ –∏ –≤—ã–¥–∞—á–µ–π.
  - `GET /dashboard/promo-codes/upload` ‚Äî —Ñ–æ—Ä–º–∞ –∑–∞–≥—Ä—É–∑–∫–∏ CSV.
  - `POST /dashboard/promo-codes/upload` ‚Äî –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –∑–∞–≥—Ä—É–∑–∫–∏ CSV.
  - `POST /dashboard/promo-codes/{id}/issue` ‚Äî –≤—ã–¥–∞—á–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –∫–æ–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é.
  - `GET /dashboard/promo-codes/issues` ‚Äî –æ—Ç—á—ë—Ç –ø–æ –≤—ã–¥–∞—á–∞–º (—Ñ–∏–ª—å—Ç—Ä—ã –ø–æ –¥–∞—Ç–µ –∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é).
  - `GET /dashboard/promo-codes/issues/export` ‚Äî —ç–∫—Å–ø–æ—Ä—Ç –æ—Ç—á—ë—Ç–∞ –≤ CSV.
  - `GET /dashboard/promo-codes/batches` ‚Äî —Å–ø–∏—Å–æ–∫ –±–∞—Ç—á–µ–π —Å –∞–≥—Ä–µ–≥–∞—Ç–∞–º–∏.

–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ –∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è:
- –í—Å–µ —Ñ–æ—Ä–º—ã –∑–∞—â–∏—â–µ–Ω—ã CSRF, —Ñ–∞–π–ª –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è –ø–æ —Ä–∞–∑–º–µ—Ä—É (<= min(`REQUEST_SIZE_LIMIT`, 5MB)) –∏ —Ç–∏–ø—É (`text/csv`, `text/plain`, `application/vnd.ms-excel`).
- CSV: –ø–µ—Ä–≤–∞—è —Å—Ç—Ä–æ–∫–∞ ‚Äî –∑–∞–≥–æ–ª–æ–≤–æ–∫. –û–±—è–∑–∞—Ç–µ–ª—å–Ω–∞—è –∫–æ–ª–æ–Ω–∫–∞: `code`. –î–æ–ø—É—Å—Ç–∏–º—ã `expires_at`, `meta`.
- –ò–º–ø–æ—Ä—Ç –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –≤ –Ω–æ–≤—ã–π –±–∞—Ç—á; –¥—É–±–ª–∏–∫–∞—Ç—ã `code` –ø—Ä–æ–ø—É—Å–∫–∞—é—Ç—Å—è (INSERT IGNORE), –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç—Å—è —Å—á—ë—Ç—á–∏–∫–∏ ¬´–∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–æ/–ø—Ä–æ–ø—É—â–µ–Ω–æ¬ª.
- –í—ã–¥–∞—á–∞ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –≤ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ —Å `SELECT ... FOR UPDATE`, –ø—Ä–æ–≤–µ—Ä—è—é—Ç—Å—è —Å—Ç–∞—Ç—É—Å –∏ —Å—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è. –õ–æ–≥ –ø–∏—à–µ—Ç—Å—è –≤ `promo_code_issues` —Å `issued_by` –∏–∑ —Å–µ—Å—Å–∏–∏.

## –í–æ—Ä–∫–µ—Ä—ã –∏ Supervisor
- `workers/longpolling.php` ‚Äî —á–∏—Ç–∞–µ—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —á–µ—Ä–µ–∑ getUpdates (–ø—Ä–∏ –∂–µ–ª–∞–Ω–∏–∏ –º–æ–∂–Ω–æ –ø–µ—Ä–µ–π—Ç–∏ –Ω–∞ webhooks)
- `workers/handler.php` ‚Äî –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –∞–ø–¥–µ–π—Ç—ã (–∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è —Ñ–æ—Ä–∫–æ–º –∏–∑ longpolling)
- `workers/scheduled_dispatcher.php` ‚Äî –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ —Ä–∞—Å—Å—ã–ª–æ–∫
- `workers/purge_refresh_tokens.php` ‚Äî —á–∏—Å—Ç–∏—Ç –ø—Ä–æ—Ç—É—Ö—à–∏–µ refresh‚Äë—Ç–æ–∫–µ–Ω—ã
- `workers/gpt.php` ‚Äî –ø—Ä–∏–º–µ—Ä –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å GPT

–ü—Ä–∏–º–µ—Ä—ã –∫–æ–Ω—Ñ–∏–≥–æ–≤ –¥–ª—è Supervisor ‚Äî –≤ `docker/supervisor`. –ù–∞ VPS —Å–∫–æ–ø–∏—Ä—É–π—Ç–µ –∏—Ö –≤ `/etc/supervisor/`, –≤—ã–ø–æ–ª–Ω–∏—Ç–µ `supervisorctl reread && supervisorctl update`.

## –ö–æ–Ω—Å–æ–ª—å
–í—Å–µ –∫–æ–º–∞–Ω–¥—ã –∑–∞–ø—É—Å–∫–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ `php run`:
- `list` ‚Äî —Å–ø–∏—Å–æ–∫ –∫–æ–º–∞–Ω–¥
- `help <command>` ‚Äî –ø–æ–º–æ—â—å –ø–æ –∫–æ–º–∞–Ω–¥–µ
- `migrate:run|create|rollback` ‚Äî –º–∏–≥—Ä–∞—Ü–∏–∏ (Phinx)
- `admin:create` ‚Äî —Å–æ–∑–¥–∞—Ç—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ Dashboard
- `push:send <chatId> <type> [payload]` ‚Äî –æ—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π –∏–∑ CLI
- `refresh:purge` ‚Äî –æ—á–∏—Å—Ç–∫–∞ refresh‚Äë—Ç–æ–∫–µ–Ω–æ–≤
- `scheduled:dispatch` ‚Äî –æ—Ç–ø—Ä–∞–≤–∫–∞ –æ—Ç–ª–æ–∂–µ–Ω–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
- `filter:update` ‚Äî —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞–º–∏ —Ñ–∏–ª—å—Ç—Ä–æ–≤ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π (Redis/.env)

## –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
–°–º. –ø–æ–¥—Ä–æ–±–Ω—ã–π —Å–ø–∏—Å–æ–∫ –∏ –ø—Ä–∏–º–µ—Ä—ã –≤ `ENVIRONMENT.md`. –ö—Ä–∞—Ç–∫–æ: `APP_*`, `DB_*`, `REDIS_*`, `JWT_*`, `CORS_ORIGINS`, `CSP_*`, `RATE_LIMIT_*`, `REQUEST_SIZE_LIMIT`, `BOT_*`, `TG_*` (—Ñ–∏–ª—å—Ç—Ä—ã), `TELEMETRY_ENABLED`, `WORKERS_*`, `AITUNNEL_API_KEY`.

## –†–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏–µ
- Docker: `docker compose up -d --build`, –º–∏–≥—Ä–∞—Ü–∏–∏: `docker compose exec app php run migrate:run`
- VPS (–±–µ–∑ Docker): –Ω–∞—Å—Ç—Ä–æ–π—Ç–µ Nginx + PHP‚ÄëFPM, —Å–∫–æ–ø–∏—Ä—É–π—Ç–µ –∫–æ–Ω—Ñ–∏–≥–∏ Supervisor, –≤—ã–ø–æ–ª–Ω–∏—Ç–µ –º–∏–≥—Ä–∞—Ü–∏–∏ –∏ –≤–∫–ª—é—á–∏—Ç–µ —Å–µ—Ä–≤–∏—Å—ã. –ü–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–∏ ‚Äî –≤ `DEPLOYMENT.md`.

## –õ–∏—Ü–µ–Ω–∑–∏—è
–°–º. `LICENSE.txt`.

## UTM ÓÚ˜∏Ú (Dashboard)

- œÛÚ¸: `GET/POST /dashboard/utm`.
- ‘ËÎ¸Ú˚ ÔÓ ‰‡ÚÂ: ÔÓÎˇ `from` Ë `to` (HTML `datetime-local`), ÙËÎ¸ÚÛ˛Ú ÔÓ `tg_pre_checkout.received_at`.
- √ÛÔÔËÓ‚Í‡: ÔÓ ÔÓÎÌÓÏÛ ÁÌ‡˜ÂÌË˛ `telegram_users.utm` (ÔÛÒÚ˚Â ó Í‡Í `(no utm)`).
- ÃÂÚËÍË: ÒÛÏÏ‡ `SUM(tg_pre_checkout.total_amount)` ‰Îˇ Í‡Ê‰ÓÈ UTM Ë Ó·˘‡ˇ ÒÛÏÏ‡ ÔÓ ‚˚·ÓÍÂ.
- ≈‰ËÌËˆ˚: ÒÛÏÏ˚ ÓÚÓ·‡Ê‡˛ÚÒˇ ‚ ÏËÌËÏ‡Î¸Ì˚ı Â‰ËÌËˆ‡ı ‚‡Î˛Ú˚ (ˆÂÌÚ˚/ÍÓÔÂÈÍË) Ú‡Í, Í‡Í ÔËıÓ‰ˇÚ ÓÚ Telegram Payments.
